require(["gitbook","jquery"],function(c,p){var d,h,f,g,v=500,e=c.state,w={},n=void 0!==window.history.pushState,t=p("body");function s(e){if(null!=e&&""!==e.trim()){var t,a,n,o=[],s=-1;for(t in w){var r=w[t],i=e.toLowerCase(),l=!1,u=(r.keywords&&~r.keywords.split(/\s+/).indexOf(i.split(":").pop())&&(/.:./.test(i)?i=i.split(":").slice(0,-1).join(":"):l=!0),new RegExp("("+String(i).replace(/([-.*+?^${}()|[\]/\\])/g,"\\$1")+")","gi"));(l||~(s=r.body.toLowerCase().indexOf(i)))&&o.push({url:t,title:r.title,body:r.body.substr(Math.max(0,s-50),v).replace(/^[^\s,.]+./,"").replace(/(..*)[\s,.].*/,"$1").replace(u,'<span class="search-highlight-keyword">$1</span>')})}a={count:o.length,query:i,results:o},d=p("#book-search-results"),h=d.find(".search-results-list"),g=d.find(".search-results-title"),f=g.find(".search-results-count"),g=g.find(".search-query"),d.addClass("open"),n=0===a.count,d.toggleClass("no-results",n),h.empty(),f.text(a.count),g.text(a.query),a.results.forEach(function(e){var t=p("<li>",{class:"search-results-item"}),n=p("<h3>"),o=p("<a>",{href:c.state.basePath+"/"+e.url+"?h="+encodeURIComponent(a.query),text:e.title,"data-is-search":1}),e=(o[0].href.split("?")[0]===window.location.href.split("?")[0]&&o[0].setAttribute("data-need-reload",1),e.body.trim()),e=(e.length>v&&(e+="..."),p("<p>").html(e));o.appendTo(n),n.appendTo(t),e.appendTo(t),t.appendTo(h)}),p(".body-inner").scrollTop(0)}}function o(e){var n,o,a;t.addClass("with-search"),t.addClass("search-loading"),n=function(){s(e),t.removeClass("search-loading")},function(){var e=this,t=arguments;a=a||setTimeout(function(){a=null,n.apply(e,t)},o)}()}function a(){t.removeClass("with-search"),p("#book-search-results").removeClass("open")}function r(){var e=p("body");e.on("keyup","#book-search-input input",function(e){13===e.keyCode&&n&&(e=y("q",p(this).val()),window.history.pushState({path:e},null,e)),0===(e=p("#book-search-input input").val()).length?a():o(e)}),e.on("blur","#book-search-input input",function(e){var t;n&&(t=y("q",p(this).val()),window.history.pushState({path:t},null,t))})}c.events.on("start",function(){r(),p.getJSON(e.basePath+"/search_plus_index.json").then(function(e){w=e,u(),a()})});var i={ignoreJoiners:!0,acrossElements:!0,separateWordSearch:!1},l=function(e){var t=p(".page-inner");/(?:(.+)?\:)(.+)/.test(e)&&t.mark(RegExp.$1,i),t.mark(e,i),setTimeout(function(){var e=p('mark[data-markjs="true"]');e.length&&e[0].scrollIntoView()},100)};function u(){var e,t;/\b(q|h)=([^&]+)/.test(window.location.search)&&(t=RegExp.$1,e=decodeURIComponent(RegExp.$2),("q"===t?o:l)(e),p("#book-search-input input").val(e))}function y(e,t){t=encodeURIComponent(t);var n,o=window.location.href.replace(/([?&])(?:q|h)=([^&]+)(&|$)/,function(e,t,n,o){return"&"===o?t:""}),a=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");return a.test(o)?null!=t?o.replace(a,"$1"+e+"="+t+"$2$3"):(o=(n=o.split("#"))[0].replace(a,"$1$3").replace(/(&|\?)$/,""),void 0!==n[1]&&null!==n[1]&&(o+="#"+n[1]),o):(null!=t&&(a=-1!==o.indexOf("?")?"&":"?",o=(n=o.split("#"))[0]+a+e+"="+t,void 0!==n[1])&&null!==n[1]&&(o+="#"+n[1]),o)}c.events.on("page.change",u),window.addEventListener("click",function(e){"A"===e.target.tagName&&e.target.getAttribute("data-need-reload")&&setTimeout(function(){window.location.reload()},100)},!0)});